---
title: "Hands-on Exercise 1"
author: "Bao Sihan"
---

# Learning outcome

In this exercise, I practice the basic idea of **Layered Grammar of Graphics** using **ggplot2**.\
By the end, I should be able to build common statistical charts by combining key components: **data**, **aes()**, **geoms**, **stats**, **facets**, **coordinates**, and **themes**.

# Getting started

## Installing and loading the required libraries

The code chunk below uses `p_load()` from **pacman** to check whether the packages are installed.\
If not installed, it will install them; if installed, it will load them into the R session.

```{r}
pacman::p_load(tidyverse)
```

## Importing the data

Here we import the dataset `Exam_data.csv` using `read_csv()` (from **readr**, which is part of tidyverse).

```{r}
exam_data <- read_csv("data/Exam_data.csv")
```

Quick notes about the dataset:

-   It contains year-end exam results for a cohort of Primary 3 students.
-   Categorical variables: `ID`, `CLASS`, `GENDER`, `RACE`
-   Continuous variables: `MATHS`, `ENGLISH`, `SCIENCE`

# Introducing ggplot2

**ggplot2** is a package for creating data-driven graphics using the idea of *Grammar of Graphics*.\
Instead of “drawing” a chart in one step, we build a plot layer by layer.

## R Graphics vs ggplot2 (a quick comparison)

Below is a simple histogram using **base R**.

```{r}
hist(exam_data$MATHS)
```

Now we do a similar plot using **ggplot2**.\
Although the code is longer, ggplot2 is more flexible and scalable when plots become more complex.

```{r}
ggplot(data=exam_data, aes(x = MATHS)) +
  geom_histogram(bins=10,
                 boundary = 100,
                 color="black",
                 fill="grey") +
  ggtitle("Distribution of Maths scores")
```

# Grammar of Graphics (why it matters)

A key idea is: a good chart can be described as a set of *building blocks*.

In ggplot2, we usually think in these components:

-   **Data**: the dataset to plot.
-   **Aesthetics (aes)**: how variables map to visual properties (x, y, color, size, etc.).
-   **Geoms**: what marks to draw (bar, point, line, histogram, etc.).
-   **Stats**: transformations or summaries (counts, means, smooth lines, etc.).
-   **Facets**: split data into small multiples.
-   **Coordinates**: how to project data (flip axes, zoom ranges, etc.).
-   **Themes**: style of non-data elements (background, text, grid, etc.).

# Essential Grammatical Elements in ggplot2

## 1) data

Calling `ggplot()` with only `data=` gives a blank canvas (a ggplot object).

```{r}
ggplot(data=exam_data)
```

## 2) Aesthetic mappings: `aes()`

Here we add an aesthetic mapping (x-axis is `MATHS`).\
Still no geom, so it will not draw points/bars yet.

```{r}
ggplot(data=exam_data,
       aes(x= MATHS))
```

## 3) Geoms (geometric objects)

A plot needs at least one geom. We add geoms with `+`.

### geom_bar (bar chart for counts)

```{r}
ggplot(data=exam_data,
       aes(x=RACE)) +
  geom_bar()
```

### geom_dotplot

A dotplot is useful to see a binned distribution using dots.

```{r}
ggplot(data=exam_data,
       aes(x = MATHS)) +
  geom_dotplot(dotsize = 0.5)
```

We can adjust `binwidth` and hide the y-axis:

```{r}
ggplot(data=exam_data,
       aes(x = MATHS)) +
  geom_dotplot(binwidth=2.5,
               dotsize = 0.5) +
  scale_y_continuous(NULL,
                     breaks = NULL)
```

### geom_histogram

Default histogram:

```{r}
ggplot(data=exam_data,
       aes(x = MATHS)) +
  geom_histogram()
```

#### Modifying a geom (change parameters in geom)

```{r}
ggplot(data=exam_data,
       aes(x= MATHS)) +
  geom_histogram(bins=20,
                 color="black",
                 fill="light blue")
```

#### Modifying the mapping (change `aes()`)

Here we map `fill` to `GENDER` so different genders get different fills.

```{r}
ggplot(data=exam_data,
       aes(x= MATHS,
           fill = GENDER)) +
  geom_histogram(bins=20,
                 color="grey30")
```

### geom_density

Density plot for a smooth distribution curve:

```{r}
ggplot(data=exam_data,
       aes(x = MATHS)) +
  geom_density()
```

If we add `colour = GENDER`, we will get separate curves by gender.

```{r}
ggplot(data=exam_data,
       aes(x = MATHS,
           colour = GENDER)) +
  geom_density()
```

### geom_boxplot

Boxplot is good for comparing distribution between groups.

```{r}
ggplot(data=exam_data,
       aes(y = MATHS,
           x= GENDER)) +
  geom_boxplot()
```

Notched boxplot:

```{r}
ggplot(data=exam_data,
       aes(y = MATHS,
           x= GENDER)) +
  geom_boxplot(notch=TRUE)
```

### geom_violin

Violin plot shows the distribution shape.

```{r}
ggplot(data=exam_data,
       aes(y = MATHS,
           x= GENDER)) +
  geom_violin()
```

### geom_point (scatterplot)

```{r}
ggplot(data=exam_data,
       aes(x= MATHS,
           y=ENGLISH)) +
  geom_point()
```

### Combine geoms

Here we combine a boxplot with jittered points to show both summary + individual values.

```{r}
ggplot(data=exam_data,
       aes(y = MATHS,
           x= GENDER)) +
  geom_boxplot() +
  geom_point(position="jitter",
             size = 0.5)
```

# Essential Grammatical Elements in ggplot2: stat

Stats are used when we want **summaries** or **transformations** (e.g., mean points, smoothing lines).

## Working with stat()

A boxplot itself uses statistical transformation internally:

```{r}
ggplot(data=exam_data,
       aes(y = MATHS, x= GENDER)) +
  geom_boxplot()
```

## stat_summary() method (add mean)

We can add mean points using `stat_summary()`.

```{r}
ggplot(data=exam_data,
       aes(y = MATHS, x= GENDER)) +
  geom_boxplot() +
  stat_summary(geom = "point",
               fun = "mean",
               colour ="red",
               size=4)
```

## Using geom() but override stat

Same idea, but we use `geom_point()` with `stat="summary"`:

```{r}
ggplot(data=exam_data,
       aes(y = MATHS, x= GENDER)) +
  geom_boxplot() +
  geom_point(stat="summary",
             fun="mean",
             colour="red",
             size=4)
```

## Add a best fit curve on a scatterplot

Default smooth:

```{r}
ggplot(data=exam_data,
       aes(x= MATHS, y=ENGLISH)) +
  geom_point() +
  geom_smooth(size=0.5)
```

We can specify a linear model explicitly:

```{r}
ggplot(data=exam_data,
       aes(x= MATHS,
           y=ENGLISH)) +
  geom_point() +
  geom_smooth(method=lm,
              linewidth=0.5)
```

# Essential Grammatical Elements in ggplot2: Facets

Facets split the data into subsets and create multiple panels.

## facet_wrap()

```{r}
ggplot(data=exam_data,
       aes(x= MATHS)) +
  geom_histogram(bins=20) +
  facet_wrap(~ CLASS)
```

## facet_grid()

```{r}
ggplot(data=exam_data,
       aes(x= MATHS)) +
  geom_histogram(bins=20) +
  facet_grid(~ CLASS)
```

# Essential Grammatical Elements in ggplot2: Coordinates

Coordinates control how we view the plot space.

## coord_flip()

```{r}
ggplot(data=exam_data,
       aes(x=RACE)) +
  geom_bar()
```

Flip the axes:

```{r}
ggplot(data=exam_data,
       aes(x=RACE)) +
  geom_bar() +
  coord_flip()
```

## Changing x/y range with coord_cartesian()

This is a “zoom” without dropping data outside the range.

```{r}
ggplot(data=exam_data,
       aes(x= MATHS, y=ENGLISH)) +
  geom_point() +
  geom_smooth(method=lm,
              size=0.5) +
  coord_cartesian(xlim=c(0,100),
                  ylim=c(0,100))
```

# Essential Grammatical Elements in ggplot2: Themes

Themes control non-data styling. Here are three common theme presets.

```{r}
ggplot(data=exam_data,
       aes(x=RACE)) +
  geom_bar() +
  coord_flip() +
  theme_gray()
```

```{r}
ggplot(data=exam_data,
       aes(x=RACE)) +
  geom_bar() +
  coord_flip() +
  theme_classic()
```

```{r}
ggplot(data=exam_data,
       aes(x=RACE)) +
  geom_bar() +
  coord_flip() +
  theme_minimal()
```
